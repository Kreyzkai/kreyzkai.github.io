<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chris' Multiple Choice Generator</title>
<style>
/* TEACHER UI - EXACT 006 PRESERVED */
body{font-family:Arial, sans-serif;background:#f4f6fa;padding:20px;margin:0;}
.teacher{max-width:1450px;margin:auto;background:#fff;padding:25px;border-radius:12px;box-shadow: 0 4px 10px rgba(0,0,0,0.1);}
h1{text-align:center; color:#003366;}
.row{display:grid;grid-template-columns:40px 1.5fr 1fr repeat(4, 1.2fr) 40px;gap:10px;margin-bottom:25px;align-items:start;border-bottom:1px solid #eee;padding-bottom:15px;}
input[type="text"], input[type="password"]{font-size:14px;padding:6px;border:1px solid #ccc;border-radius:4px;width:90%}
.choiceCell{display:flex; flex-direction:column; gap:4px; align-items:center; background:#f9f9f9; padding:8px; border-radius:8px; border:1px dashed #ccc;}
.choiceCell img{max-height:60px; max-width:100%; display:none; margin-bottom:4px; border-radius:4px;}
.deleteBtn{border:none;background:#c62828;color:white;font-size:18px;cursor:pointer;border-radius:6px;padding:4px 8px}
.controls{margin-top:15px;display:flex;gap:10px;flex-wrap:wrap;}
button{font-size:18px;padding:10px 16px;cursor:pointer;border-radius:6px;border:1px solid #ccc}
#saveBtn{background:#003366;color:white;border:none}
.file-label{font-size:10px; cursor:pointer; color:#1976d2; text-decoration:underline}

/* STUDENT UI - 006 GAMEPLAY */
#studentApp { display:none; height:100vh; flex-direction:column; overflow:hidden; }
.scale-1{font-size:20px} .scale-2{font-size:24px} .scale-3{font-size:28px} .scale-4{font-size:32px} .scale-5{font-size:16px}
#displayArea{cursor:pointer; flex: 0 1 auto; min-height: 10vh; display:flex; align-items:center; justify-content:center; padding:10px;}
#mainText{font-size:1.5em; font-weight:bold; color:#003366; line-height: 1.2;}
.buttons{display:grid; grid-template-columns:repeat(2,1fr); gap:15px; max-width:1200px; margin:0 auto; padding:0 15px; flex: 1 1 auto;}
.buttons button{font-size:1em; padding:10px; border:none; color:white; border-radius:15px; cursor:pointer; font-weight:bold; display:flex; flex-direction:column; align-items:center; gap:5px; justify-content:center; overflow:hidden; max-height: 35vh;}
.buttons img{width:auto; height:auto; max-width:100%; max-height:25vh; object-fit:contain; border-radius:8px; background:white;}
.b0{background:#1976d2;} .b1{background:#d32f2f;} .b2{background:#388e3c;} .b3{background:#fbc02d;color:black;}
#feedback{font-size:1.1em; margin:5px; font-weight:bold; min-height:1.2em; text-align:center;}
#bottomBar { background: white; border-top: 1px solid #ccc; padding: 10px; display: flex; justify-content: center; gap: 10px;}
.nav-btn { font-size: 0.8em; padding: 8px 14px; cursor: pointer; border: 1px solid #aaa; border-radius: 6px; background: #fff;}
#zoomBtn{position:fixed; right:20px; bottom:80px; width:45px; height:45px; border-radius:50%; border:none; background:#003366; color:white; font-size:20px; cursor:pointer; z-index:101;}
#watermark{position:fixed; left:12px; bottom:70px; font-size:12px; opacity:0.35; cursor:pointer; z-index:1000;}
.correct-view { grid-column: 1 / span 2; max-height: 70vh !important; }
.correct-view img { max-height: 55vh !important; }

/* 001 START/END SCREEN OVERLAYS */
.screen { display: none; height: 100vh; width: 100%; background: #003366; color: white; flex-direction: column; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; z-index: 2000; }
.screen.active { display: flex; }
.card { background: white; color: #333; padding: 40px; border-radius: 20px; text-align: center; max-width: 600px; width: 90%; }
.card h1 { color: #003366; margin-top: 0; }
.btn-001 { background: #28a745; color: white; border: none; padding: 20px 50px; font-size: 24px; border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 20px; }
.btn-retry-001 { background: #003366; color: white; border: none; padding: 15px 40px; font-size: 20px; border-radius: 50px; cursor: pointer; margin-top: 20px; }
</style>
</head>
<body class="scale-1">

<div id="teacherApp" class="teacher">
    <h1>Chris' Multiple Choice Generator</h1>
    <div style="display:flex; gap:20px; margin-bottom:20px;">
        <div>
            <p>Game Title / Topic</p>
            <input id="titleInput" placeholder="e.g. Science Quiz" style="width:300px; padding:10px;">
        </div>
        <div>
            <p>Editor Password</p>
            <input type="password" id="pwInput" placeholder="Set password" style="width:200px; padding:10px;" value="admin">
        </div>
    </div>
    <h3>Questions & Choices</h3>
    <div id="rows"></div>
    <div class="controls">
        <button onclick="window.location.href='index.html'">‚¨Ö Back to Main Page</button>
        <button onclick="location.reload()">üîÑ Reset Generator</button>
        <button onclick="addRow()">‚ûï Add Question</button>
        <button onclick="clearAll()">üóë Clear All</button>
        <button id="saveBtn" onclick="generate()">üíæ Save & Download Student Game</button>
    </div>
</div>

<div id="studentApp">
    <div id="introScreen" class="screen active">
        <div class="card">
            <h1>Chris' Multiple Choice Generator</h1>
            <h2 id="introTitle"></h2>
            <button class="btn-001" onclick="startGame()">START GAME</button>
        </div>
    </div>

    <h1 id="studentTitle" style="font-size:0.7em; color:#777; padding:5px; margin:0; text-align:center;"></h1>
    <div id="displayArea" onclick="toggleQ()"><div id="mainText"></div></div>
    <div class="buttons" id="buttons"></div>
    <div id="feedback"></div>
    <div id="bottomBar">
        <button class="nav-btn" onclick="prev()">‚¨Ö Prev Question</button>
        <button class="nav-btn" onclick="retry()">üîÑ Retry</button>
        <button class="nav-btn" onclick="next()">Next ‚û°</button>
    </div>

    <div id="endScreen" class="screen">
        <div class="card">
            <h1>Game Over!</h1>
            <h2>You have completed the quiz.</h2>
            <button class="btn-retry-001" onclick="location.reload()">Restart Quiz</button>
        </div>
    </div>

    <button id="zoomBtn" onclick="zoom()">üîç</button>
    <div id="watermark" onclick="rehydrate()">cmarasigan</div>
</div>

<script>
let startData = []; 
let activePW = "admin";
const rowsDiv = document.getElementById("rows");
const titleInput = document.getElementById("titleInput");
const pwInput = document.getElementById("pwInput");
let rows = [];
let qCounter = 0;

window.onload = () => {
    rowsDiv.innerHTML = "";
    if(startData.length > 0) {
        document.getElementById("teacherApp").style.display = "none";
        document.getElementById("studentApp").style.display = "flex";
        document.getElementById("introTitle").textContent = titleInput.value;
        document.getElementById("studentTitle").textContent = titleInput.value;
        pwInput.value = activePW; 
        startData.forEach(d => addRow(d));
        render();
    } else { addRow(); }
};

function startGame() { document.getElementById("introScreen").classList.remove("active"); }

function addRow(existingData = null){
    const id = "q" + qCounter++;
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
        <div style="font-weight:bold; padding-top:8px">${rows.length+1}.</div>
        <div>
            <input type="text" placeholder="Question" oninput="autoAdd()" style="margin-bottom:5px" value="${existingData?existingData.q:''}">
            <input type="text" placeholder="Clue (optional)" value="${existingData?existingData.clue:''}">
        </div>
        <div style="font-size:11px; color:#666">Tick correct -></div>
        ${[0,1,2,3].map(i => `
            <div class="choiceCell">
                <input type="radio" name="${id}" ${ (existingData && existingData.correct === i) || (!existingData && i===0) ? 'checked' : ''}>
                <img src="${existingData && existingData.choiceImgs[i] ? existingData.choiceImgs[i] : ''}" style="display:${existingData && existingData.choiceImgs[i] ? 'block' : 'none'}">
                <label class="file-label">Upload<input type="file" accept="image/*" style="display:none" onchange="handleFile(this)"></label>
                <input type="text" placeholder="Choice ${i+1}" value="${existingData && existingData.choices[i] ? existingData.choices[i] : ''}">
            </div>
        `).join('')}
        <button class="deleteBtn" onclick="this.parentElement.remove(); rows=rows.filter(r=>r!==this.parentElement); renumber();">‚úñ</button>
    `;
    rows.push(row); rowsDiv.appendChild(row);
}

function handleFile(input) {
    const reader = new FileReader();
    reader.onload = ()=> { const img = input.parentElement.previousElementSibling; img.src = reader.result; img.style.display = "block"; };
    if(input.files[0]) reader.readAsDataURL(input.files[0]);
}

function autoAdd(){ if(rows[rows.length-1].querySelector("input").value.trim() !== "") addRow(); }
function renumber() { rows.forEach((r,i) => r.children[0].textContent = (i+1)+'.'); }
function clearAll() { if(confirm("Clear all?")) { rowsDiv.innerHTML = ""; rows = []; addRow(); } }

function rehydrate() {
    if(prompt("Enter Password:") === activePW) {
        document.getElementById("studentApp").style.display = "none";
        document.getElementById("teacherApp").style.display = "block";
    }
}

function generate(){
    const newData = [];
    rows.forEach(r => {
        const q = r.children[1].querySelector("input").value.trim();
        const choices = []; const choiceImgs = []; let correctIdx = -1;
        r.querySelectorAll(".choiceCell").forEach((cell, idx) => {
            const text = cell.querySelector("input[type=text]").value.trim();
            const img = cell.querySelector("img").src || "";
            if(text !== "" || img.startsWith("data:image")) {
                if(cell.querySelector("input[type=radio]").checked) correctIdx = choices.length;
                choices.push(text); choiceImgs.push(img);
            }
        });
        if(q && choices.length >= 2 && correctIdx !== -1) newData.push({q, clue: r.children[1].querySelectorAll("input")[1].value.trim(), choices, choiceImgs, correct: correctIdx});
    });

    let docStr = document.documentElement.outerHTML;
    docStr = docStr.replace(/let startData = \[.*?\];/, `let startData = ${JSON.stringify(newData)};`);
    docStr = docStr.replace(/let activePW = ".*?";/, `let activePW = "${pwInput.value}";`);
    const blob = new Blob([docStr], {type:"text/html"});
    const a = document.createElement("a"); a.href = URL.createObjectURL(blob);
    a.download = (titleInput.value || "Quiz").replace(/\s+/g, '_') + ".html"; a.click();
}

let i = 0, scale = 0, showingClue = false;
function render(){
    showingClue = false; const d = startData[i];
    document.getElementById("mainText").textContent = d.q;
    document.getElementById("feedback").textContent = "";
    const btns = document.getElementById("buttons"); btns.innerHTML = "";
    d.choices.forEach((c,idx)=>{
        const b = document.createElement("button"); b.className = "b"+idx;
        if(d.choiceImgs[idx].length > 10) { const img = document.createElement("img"); img.src = d.choiceImgs[idx]; b.appendChild(img); }
        if(c) { const s = document.createElement("span"); s.textContent = c; b.appendChild(s); }
        b.onclick = () => {
            if(idx === d.correct) {
                btns.innerHTML = ""; let win = b.cloneNode(true); win.classList.add("correct-view");
                win.onclick = () => render(); btns.appendChild(win);
                document.getElementById("feedback").textContent = "Correct!";
            } else { b.style.opacity = "0.15"; b.disabled = true; document.getElementById("feedback").textContent = "Try again!"; }
        };
        btns.appendChild(b);
    });
}

function next(){ if(i < startData.length-1){ i++; render(); } else { document.getElementById("endScreen").classList.add("active"); } }
function prev(){ if(i > 0){ i--; render(); } }
function retry(){ render(); }
function toggleQ() {
    showingClue = !showingClue; const d = startData[i];
    const el = document.getElementById("mainText");
    el.textContent = showingClue && d.clue ? "Clue: " + d.clue : d.q;
    el.style.fontStyle = showingClue && d.clue ? "italic" : "normal";
}
function zoom(){ scale = (scale + 1) % 5; document.body.className = ["scale-1","scale-2","scale-3","scale-4","scale-5"][scale]; }
</script>
</body>
</html>