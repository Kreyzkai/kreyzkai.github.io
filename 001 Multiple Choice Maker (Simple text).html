<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chris' Multiple Choice Generator ‚Äì Linked Edition</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f6fa; margin: 0; padding: 20px; color: #333; }
    .teacher { max-width: 1300px; margin: auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #003366; margin-bottom: 20px; }

    .settings-panel { display: flex; gap: 15px; align-items: center; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #eee; }
    .settings-panel input { padding: 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; flex-grow: 1; }

    .row { display: grid; grid-template-columns: 30px 1.5fr 1fr 1fr 1fr 1fr 1fr 1.2fr 40px; gap: 8px; margin-bottom: 8px; align-items: center; padding-bottom: 8px; border-bottom: 1px solid #f0f0f0; }
    .row input { width: 100%; box-sizing: border-box; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 13px; }
    .deleteBtn { background: #c62828; color: white; border: none; padding: 8px; cursor: pointer; border-radius: 6px; font-weight: bold; }

    .img-upload-cell { font-size: 10px; display: flex; flex-direction: column; align-items: center; }
    .img-preview { max-height: 35px; margin-top: 2px; border-radius: 4px; display: none; }

    .controls { display: flex; gap: 15px; margin-top: 25px; justify-content: center; }
    button.main-btn { font-size: 16px; padding: 12px 24px; cursor: pointer; border-radius: 8px; border: none; background: #003366; color: white; transition: 0.2s; }
    button.secondary { background: #607d8b; }

    .mode-section { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #eee; }
    .mode-section h3 { margin: 0 0 10px 0; color: #003366; font-size: 16px; }
    .mode-section label { margin-right: 20px; font-size: 14px; }
    .help-text { font-size: 12px; color: #666; margin-top: 8px; font-style: italic; }
</style>
</head>
<body>

<div class="teacher">
    <h1>Multiple Choice Setup</h1>

    <div class="settings-panel">
        <label>Game Title:</label>
        <input type="text" id="titleInput" placeholder="e.g. Comet II Lesson 11">
    </div>

    <div class="mode-section">
        <h3>Link Next Game (Optional)</h3>
        <label><input type="checkbox" id="enableNextGame" onchange="toggleNextGameSection()"> Link to another game after completion</label>
        <div id="nextGameSection" style="display: none; margin-top: 15px;">
            <label style="display: block; margin-bottom: 8px;">Next Game Type:</label>
            <select id="nextGameType" style="width: 100%; padding: 10px; font-size: 14px; margin-bottom: 10px;">
                <option value="">-- Select Game Type --</option>
                <option value="multiple_choice">Multiple Choice Game</option>
                <option value="fill_blank">Fill in the Blank Game</option>
                <option value="jumbler">Sentence Jumbler</option>
            </select>
            <label style="display: block; margin-bottom: 8px;">Upload Next Game File:</label>
            <input type="file" id="nextGameFile" accept=".html" style="width: 100%; padding: 8px; font-size: 14px;">
            <div class="help-text">Upload the student game file (.html) that should play next</div>
        </div>
    </div>

    <div id="rowsContainer"></div>

    <div class="controls">
        <button class="main-btn secondary" onclick="goBack()">‚¨Ö Back to Main Page</button>
        <button class="main-btn secondary" onclick="clearAll()">üóë Clear All</button>
        <button class="main-btn" onclick="generate()">üíæ Generate Student Game</button>
    </div>
</div>

<script>
let rowCount = 0;
const container = document.getElementById('rowsContainer');

function addRow() {
    rowCount++;
    const div = document.createElement('div');
    div.className = 'row';
    div.innerHTML = `
        <div style="font-weight:bold; color:#999; font-size:12px">${rowCount}</div>
        <input type="text" placeholder="Question" oninput="autoAdd(this)">
        <input type="text" placeholder="Hint (Optional)">
        <input type="text" placeholder="Correct Choice">
        <input type="text" placeholder="Choice 2">
        <input type="text" placeholder="Choice 3">
        <input type="text" placeholder="Choice 4">
        <div class="img-upload-cell">
            <input type="file" accept="image/*" onchange="previewImg(this)">
            <img class="img-preview" src="">
        </div>
        <button class="deleteBtn" onclick="this.parentElement.remove(); renumber();">‚úñ</button>
    `;
    container.appendChild(div);
}

function previewImg(input) {
    const reader = new FileReader();
    const img = input.nextElementSibling;
    reader.onload = e => { img.src = e.target.result; img.style.display = 'block'; };
    if(input.files[0]) reader.readAsDataURL(input.files[0]);
}

function autoAdd(input) {
    if (input.parentElement === container.lastElementChild && input.value.trim() !== "") {
        addRow();
    }
}

function renumber() {
    [...container.children].forEach((row, i) => row.firstElementChild.textContent = i + 1);
}

function clearAll() {
    if(confirm("Clear all questions?")) {
        container.innerHTML = "";
        rowCount = 0;
        addRow();
    }
}

function goBack() {
    if(confirm("This will reset your workspace.")) {
        window.location.href = 'index.html';
    }
}

function toggleNextGameSection() {
    const enabled = document.getElementById('enableNextGame').checked;
    document.getElementById('nextGameSection').style.display = enabled ? 'block' : 'none';
}

function generate() {
    const title = document.getElementById('titleInput').value || "Multiple Choice Quiz";
    const data = [];

    [...container.children].forEach(row => {
        const ins = row.querySelectorAll('input[type="text"]');
        const img = row.querySelector('.img-preview').src;
        if(ins[0].value.trim()) {
            data.push({
                q: ins[0].value.trim(),
                h: ins[1].value.trim(),
                img: img.startsWith('data') ? img : null,
                choices: [ins[2].value.trim(), ins[3].value.trim(), ins[4].value.trim(), ins[5].value.trim()].filter(x => x !== "")
            });
        }
    });

    if(!data.length) return alert("Add at least one question!");

    const enableNextGame = document.getElementById('enableNextGame').checked;
    const nextGameFile = document.getElementById('nextGameFile').files[0];
    const nextGameType = document.getElementById('nextGameType').value;

    if (enableNextGame && nextGameFile && nextGameType) {
        const reader = new FileReader();
        reader.onload = e => {
            const nextGameHTML = e.target.result;
            proceedWithGeneration(nextGameHTML, nextGameType);
        };
        reader.readAsText(nextGameFile);
    } else {
        proceedWithGeneration(null, null);
    }

    function proceedWithGeneration(nextGameHTML, nextGameType) {
        let finalHTML = studentTemplate
            .replace('//%%TITLE%%', `const gameTitle = "${title}";`)
            .replace('//%%DATA%%', `const gameData = ${JSON.stringify(data)};`);

        if (nextGameHTML && nextGameType) {
            const base64HTML = btoa(unescape(encodeURIComponent(nextGameHTML)));
            const nextGameData = { type: nextGameType, html: base64HTML };
            finalHTML = finalHTML.replace('//%%NEXTGAME%%', `const nextGameData = ${JSON.stringify(nextGameData)};`);
        } else {
            finalHTML = finalHTML.replace('//%%NEXTGAME%%', `const nextGameData = null;`);
        }

        const blob = new Blob([finalHTML], {type: 'text/html'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = title.replace(/\s+/g, '_') + ".html";
        a.click();
    }
}

addRow();

const studentTemplate = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body.scale-1 { font-size: 28px; }
        body.scale-2 { font-size: 34px; }
        body.scale-3 { font-size: 40px; }
        body.scale-4 { font-size: 46px; }
        body.scale-5 { font-size: 22px; }

        body { font-family: Arial, sans-serif; text-align: center; background: #f4f7fa; margin: 0; transition: font-size 0.2s; color: #333; }
        .screen { display: none; padding: 20px; min-height: 100vh; box-sizing: border-box; }
        .screen.active { display: flex; flex-direction: column; align-items: center; justify-content: center; }

        #introScreen { background: #003366; color: white; }
        .btn-start { font-size: 1.2em; padding: 15px 50px; cursor: pointer; background: white; color: #003366; border: none; border-radius: 50px; font-weight: bold; }

        #gameScreen { padding-bottom: 140px; justify-content: flex-start; }

        #bottomBar { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #ccc; padding: 15px; display: none; justify-content: center; gap: 15px; z-index: 100; font-size: 16px; transform: scale(1); transform-origin: bottom; }
        .nav-btn { font-size: 16px; padding: 10px 20px; cursor: pointer; border: 1px solid #aaa; border-radius: 8px; background: #fff; font-weight: bold; }
        .check-btn { background: #003366; color: white; border: none; }

        #zoomBtn { position: fixed; right: 20px; bottom: 100px; width: 55px; height: 55px; border-radius: 50%; border: none; background: #003366; color: white; font-size: 26px; cursor: pointer; z-index: 101; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        #questionText { font-weight: bold; margin: 20px 0; padding: 0 10px; }
        .choices-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; width: 95%; max-width: 900px; margin: 20px auto; }
        .choice-btn { font-size: 0.9em; padding: 18px 10px; background: white; border: 2px solid #003366; border-radius: 12px; cursor: pointer; transition: 0.2s; font-weight: bold; color: #003366; }
        .choice-btn.correct { background: #2e7d32 !important; color: white; border-color: #2e7d32; }
        .choice-btn.wrong { background: #c62828 !important; color: white; border-color: #c62828; }

        #feedback { font-size: 1.1em; font-weight: bold; margin: 20px; min-height: 1.5em; }
    </style>
</head>
<body class="scale-1">

    <div id="introScreen" class="screen active">
        <h1 id="mainTitle" style="font-size:2em; margin-bottom:40px;">Quiz Game</h1>
        <button class="btn-start" onclick="startGame()">START QUIZ</button>
    </div>

    <div id="gameScreen" class="screen">
        <div id="questionText"></div>
        <div id="choices" class="choices-grid"></div>
        <div id="feedback"></div>
    </div>

    <div id="bottomBar">
        <button class="nav-btn" onclick="prev()">‚¨Ö Back</button>
        <button class="nav-btn" onclick="next()">Next ‚û°</button>
    </div>

    <button id="zoomBtn" onclick="toggleZoom()">üîç</button>

    <script>
        //%%TITLE%%
        //%%DATA%%
        //%%NEXTGAME%%

        let index = 0, scale = 1, answered = false;

        function toggleZoom() {
            scale = (scale % 5) + 1;
            document.body.className = 'scale-' + scale;
        }

        function startGame() {
            document.getElementById('mainTitle').textContent = gameTitle;
            document.getElementById('introScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            document.getElementById('bottomBar').style.display = 'flex';
            loadQuestion();
        }

        function loadQuestion() {
            answered = false;
            const qData = gameData[index];
            const correctStr = qData.choices[0];
            const shuffledChoices = [...qData.choices].sort(() => Math.random() - 0.5);

            document.getElementById('questionText').textContent = qData.q;
            document.getElementById('feedback').textContent = "";

            const container = document.getElementById('choices');
            container.innerHTML = "";
            shuffledChoices.forEach(txt => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = txt;
                btn.onclick = () => handleChoice(txt, btn, correctStr);
                container.appendChild(btn);
            });
        }

        function handleChoice(txt, btn, correct) {
            if(answered) return;
            answered = true;
            if(txt === correct) {
                btn.classList.add('correct');
                document.getElementById('feedback').textContent = "‚úÖ Correct!";
            } else {
                btn.classList.add('wrong');
                document.getElementById('feedback').textContent = "‚ùå Incorrect";
                [...document.querySelectorAll('.choice-btn')].forEach(b => {
                    if(b.textContent === correct) b.classList.add('correct');
                });
            }
        }

        function next() {
            if (index < gameData.length - 1) { 
                index++; 
                loadQuestion(); 
            } else { 
                document.getElementById('feedback').textContent = "üéâ Quiz Complete!";
                if (typeof nextGameData !== 'undefined' && nextGameData) showContinueButton();
            }
        }

        function showContinueButton() {
            const bottomBar = document.getElementById('bottomBar');
            bottomBar.innerHTML = '';
            const continueBtn = document.createElement('button');
            continueBtn.className = 'nav-btn check-btn';
            continueBtn.style.fontSize = '18px';
            continueBtn.style.padding = '12px 24px';
            continueBtn.textContent = '‚û°Ô∏è Continue to Next Game';
            continueBtn.onclick = launchNextGame;
            bottomBar.appendChild(continueBtn);
        }

        function launchNextGame() {
            if (!nextGameData) {
                alert('No next game configured.');
                return;
            }
            const decodedHTML = decodeURIComponent(escape(atob(nextGameData.html)));
            const blob = new Blob([decodedHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.location.href = url;
        }

        function prev() { if (index > 0) { index--; loadQuestion(); } }
    <\/script>
</body>
</html>`;
</script>
</body>
</html>